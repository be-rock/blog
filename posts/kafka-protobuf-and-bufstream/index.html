<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en-us"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Streaming with Bufstream, Protobuf, and Spark &#183; Brock's Blog - Data|DevOps|Cloud</title><meta name=title content="Streaming with Bufstream, Protobuf, and Spark &#183; Brock's Blog - Data|DevOps|Cloud"><meta name=keywords content="bufstream,kafka,protobuf,spark,streaming,"><link rel=canonical href=https://be-rock.github.io/blog/posts/kafka-protobuf-and-bufstream/><meta name=author content="Brock B"><link href=https://github.com/be-rock rel=me><link href=/index.xml rel=me><meta property="og:url" content="https://be-rock.github.io/blog/posts/kafka-protobuf-and-bufstream/"><meta property="og:site_name" content="Brock's Blog - Data|DevOps|Cloud"><meta property="og:title" content="Streaming with Bufstream, Protobuf, and Spark"><meta property="og:description" content="Summary # Bufstream is said to be a drop-in replacement for Kafka via a simple Go-based binary Bufstream also standardizes on Protocol Buffers as the serialization format for messaging and integrates well with Lakehouses by writing directly to an Iceberg sink What is the point? # I often work with streaming and Kafka with Apache Spark. Setting up and managing a Kafka cluster can be cumbersome so having a quick, easy, standardized, and leightweight way to run Kafka is appealing. This blog attempts to test the claims of Buf - the company behind: Bufstream - the “drop-in replacement for Kafka” BSR - the Buf Schema Registry which implements the Confluent Schema Registry API buf CLI - a simple way to develop and manage Protobuf Note that the buf CLI will be referenced in this blog, but less of a focus."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-09T22:29:16-05:00"><meta property="article:modified_time" content="2025-11-19T20:50:36-06:00"><meta property="article:tag" content="Bufstream"><meta property="article:tag" content="Kafka"><meta property="article:tag" content="Protobuf"><meta property="article:tag" content="Spark"><meta property="article:tag" content="Streaming"><meta name=twitter:card content="summary"><meta name=twitter:title content="Streaming with Bufstream, Protobuf, and Spark"><meta name=twitter:description content="Summary # Bufstream is said to be a drop-in replacement for Kafka via a simple Go-based binary Bufstream also standardizes on Protocol Buffers as the serialization format for messaging and integrates well with Lakehouses by writing directly to an Iceberg sink What is the point? # I often work with streaming and Kafka with Apache Spark. Setting up and managing a Kafka cluster can be cumbersome so having a quick, easy, standardized, and leightweight way to run Kafka is appealing. This blog attempts to test the claims of Buf - the company behind: Bufstream - the “drop-in replacement for Kafka” BSR - the Buf Schema Registry which implements the Confluent Schema Registry API buf CLI - a simple way to develop and manage Protobuf Note that the buf CLI will be referenced in this blog, but less of a focus."><link type=text/css rel=stylesheet href=/blog/css/main.bundle.min.142b3712f190133e5550fca4b95dbea5e59e2d0e7f324f2c3cde855857f8e28adf140e354d0fd5c308dec0b6b0f5b63c8c765b750ed3212bb1fced833ab36b5b.css integrity="sha512-FCs3EvGQEz5VUPykuV2+peWeLQ5/Mk8sPN6FWFf44orfFA41TQ/VwwjewLaw9bY8jHZbdQ7TISux/O2DOrNrWw=="><script type=text/javascript src=/blog/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/blog/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/blog/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=Copy data-copied=Copied></script><script src=/blog/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=manifest href=/blog/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Streaming with Bufstream, Protobuf, and Spark","headline":"Streaming with Bufstream, Protobuf, and Spark","abstract":"\u003ch2 class=\u0022relative group\u0022\u003eSummary\n    \u003cdiv id=\u0022summary\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#summary\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cul\u003e\n\u003cli\u003eBufstream is said to be a drop-in replacement for Kafka via a simple Go-based binary\u003c\/li\u003e\n\u003cli\u003eBufstream also standardizes on Protocol Buffers as the serialization format for messaging and integrates well with Lakehouses by writing directly to an Iceberg sink\u003c\/li\u003e\n\u003c\/ul\u003e\n\n\u003ch2 class=\u0022relative group\u0022\u003eWhat is the point?\n    \u003cdiv id=\u0022what-is-the-point\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#what-is-the-point\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cul\u003e\n\u003cli\u003eI often work with streaming and Kafka with Apache Spark. Setting up and managing a Kafka cluster can be cumbersome so having a quick, easy, standardized, and leightweight way to run Kafka is appealing.\u003c\/li\u003e\n\u003cli\u003eThis blog attempts to test the claims of Buf - the company behind:\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eBufstream\u003c\/code\u003e - the \u0026ldquo;drop-in replacement for Kafka\u0026rdquo;\u003c\/li\u003e\n\u003cli\u003e\u003ccode\u003eBSR\u003c\/code\u003e - the Buf Schema Registry which implements the Confluent Schema Registry API\u003c\/li\u003e\n\u003cli\u003e\u003ccode\u003ebuf\u003c\/code\u003e CLI - a simple way to develop and manage Protobuf\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003eNote that the \u003ccode\u003ebuf\u003c\/code\u003e CLI will be referenced in this blog, but less of a focus.\u003c\/p\u003e","inLanguage":"en-us","url":"https:\/\/be-rock.github.io\/blog\/posts\/kafka-protobuf-and-bufstream\/","author":{"@type":"Person","name":"Brock B"},"copyrightYear":"2025","dateCreated":"2025-08-09T22:29:16-05:00","datePublished":"2025-08-09T22:29:16-05:00","dateModified":"2025-11-19T20:50:36-06:00","keywords":["bufstream","kafka","protobuf","spark","streaming"],"mainEntityOfPage":"true","wordCount":"1447"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/blog/ class="text-base font-medium">Brock&rsquo;s Blog - Data|DevOps|Cloud</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/blog/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Home title="Brock's Blog"><p class="text-base font-medium">Home</p></a><a href=/blog/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Posts title=Posts><p class="text-base font-medium">Posts</p></a><a href=/blog/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-base font-medium">Tags</p></a><a href=https://github.com/be-rock target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/blog/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Home title="Brock's Blog"><p class="text-bg font-bg">Home</p></a></li><li class=mt-1><a href=/blog/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Posts title=Posts><p class="text-bg font-bg">Posts</p></a></li><li class=mt-1><a href=/blog/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-bg font-bg">Tags</p></a></li><li class=mt-1><a href=https://github.com/be-rock target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=github title><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div></a></li></ul></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Streaming with Bufstream, Protobuf, and Spark</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-08-09T22:29:16-05:00>2025-08-09</time><span class="px-2 text-primary-500">&#183;</span><span>1447 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/blog/tags/bufstream/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Bufstream
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/blog/tags/kafka/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kafka
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/blog/tags/protobuf/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Protobuf
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/blog/tags/spark/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Spark
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/blog/tags/streaming/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Streaming</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">Summary<div id=summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#summary aria-label=Anchor>#</a></span></h2><ul><li>Bufstream is said to be a drop-in replacement for Kafka via a simple Go-based binary</li><li>Bufstream also standardizes on Protocol Buffers as the serialization format for messaging and integrates well with Lakehouses by writing directly to an Iceberg sink</li></ul><h2 class="relative group">What is the point?<div id=what-is-the-point class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-is-the-point aria-label=Anchor>#</a></span></h2><ul><li>I often work with streaming and Kafka with Apache Spark. Setting up and managing a Kafka cluster can be cumbersome so having a quick, easy, standardized, and leightweight way to run Kafka is appealing.</li><li>This blog attempts to test the claims of Buf - the company behind:<ul><li><code>Bufstream</code> - the &ldquo;drop-in replacement for Kafka&rdquo;</li><li><code>BSR</code> - the Buf Schema Registry which implements the Confluent Schema Registry API</li><li><code>buf</code> CLI - a simple way to develop and manage Protobuf</li></ul></li></ul><p>Note that the <code>buf</code> CLI will be referenced in this blog, but less of a focus.</p><h2 class="relative group">Getting Started<div id=getting-started class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#getting-started aria-label=Anchor>#</a></span></h2><ul><li>On a surface-level, I have found the Buf docs to be nice and well written with 4 applicable quickstart guides that will be the basis for getting started<ul><li><a href=https://buf.build/docs/bufstream/quickstart/ target=_blank>https://buf.build/docs/bufstream/quickstart/</a></li><li><a href=https://buf.build/docs/bsr/quickstart/ target=_blank>https://buf.build/docs/bsr/quickstart/</a></li><li><a href=https://buf.build/docs/cli/quickstart/ target=_blank>https://buf.build/docs/cli/quickstart/</a></li><li><a href=https://buf.build/docs/bufstream/iceberg/quickstart/ target=_blank>https://buf.build/docs/bufstream/iceberg/quickstart/</a></li></ul></li></ul><h2 class="relative group">Bufstream<div id=bufstream class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#bufstream aria-label=Anchor>#</a></span></h2><h3 class="relative group">Installation<div id=installation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#installation aria-label=Anchor>#</a></span></h3><p>Starting with <a href=https://buf.build/docs/bufstream/quickstart/ target=_blank>this Bufstream quickstart guide</a>, we are advised to download the <code>bufstream</code> CLI with <code>curl</code> and then simply <code>./bufstream serve</code>. Let&rsquo;s see if that&rsquo;s as easy as it sounds.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sSL -o bufstream <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#e6db74>&#34;https://buf.build/dl/bufstream/latest/bufstream-</span><span style=color:#66d9ef>$(</span>uname -s<span style=color:#66d9ef>)</span><span style=color:#e6db74>-</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    chmod +x bufstream
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./bufstream serve
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>&lt;snipped&gt;
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-05T22:45:14.648-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;kafka server started&#34;</span> host<span style=color:#f92672>=</span>localhost port<span style=color:#f92672>=</span><span style=color:#ae81ff>9092</span> tls<span style=color:#f92672>=</span>false public<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-05T22:45:14.648-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;kafka server started&#34;</span> host<span style=color:#f92672>=</span>127.0.0.1 port<span style=color:#f92672>=</span><span style=color:#ae81ff>9092</span> tls<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-05T22:45:14.648-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;kafka server started&#34;</span> host<span style=color:#f92672>=</span>::1 port<span style=color:#f92672>=</span><span style=color:#ae81ff>9092</span> tls<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-05T22:45:14.664-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;updating ownership&#34;</span> oldShardNum<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> oldShardCount<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> shardNum<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> shardCount<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Ok, that really was quite easy.</p><h3 class="relative group">Setting up a web-based Kafka Administrative Console (optional)<div id=setting-up-a-web-based-kafka-administrative-console-optional class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#setting-up-a-web-based-kafka-administrative-console-optional aria-label=Anchor>#</a></span></h3><p>The quickstart then recommends installing either either <a href=https://akhq.io/ target=_blank>AKHQ</a> or <a href=https://docs.redpanda.com/current/console target=_blank>Redpanda console</a> for managing Kafka-compatible workloads. The Redpanda installation is a simple 4-liner <code>docker run</code> so I&rsquo;ll give that one a try.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -p 8080:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -e KAFKA_BROKERS<span style=color:#f92672>=</span>host.docker.internal:9092 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -e KAFKA_CLIENTID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rpconsole;broker_count=1;host_override=host.docker.internal&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    docker.redpanda.com/redpandadata/console:v3.1.3
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>&lt;snipped&gt;
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;warn&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T03:56:19.199Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;failed to test Kafka connection, going to retry in 1s&#34;</span>,<span style=color:#e6db74>&#34;remaining_retries&#34;</span>:5<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;fatal&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T03:56:51.007Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;failed to start console service&#34;</span>,<span style=color:#e6db74>&#34;error&#34;</span>:<span style=color:#e6db74>&#34;failed to test kafka connectivity: failed to test kafka connection: failed to request metadata: unable to dial: dial tcp: lookup host.docker.internal on 10.0.2.3:53: no such host&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Hmmm, that did not work as expected. I am testing on Linux and believe that the quickstart presumes we&rsquo;re running MacOS. I have also seen subtle network differences in the past when working with Docker (ok, Podman) on Linux. This eventually worked:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --network<span style=color:#f92672>=</span>host -p 8080:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -e KAFKA_BROKERS<span style=color:#f92672>=</span>localhost:9092 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    docker.redpanda.com/redpandadata/console:v3.1.3
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T04:08:00.900Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;started Redpanda Console&#34;</span>,<span style=color:#e6db74>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;v3.1.3&#34;</span>,<span style=color:#e6db74>&#34;built_at&#34;</span>:<span style=color:#e6db74>&#34;1753360440&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T04:08:00.903Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;connecting to Kafka seed brokers, trying to fetch cluster metadata&#34;</span>,<span style=color:#e6db74>&#34;seed_brokers&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;localhost:9092&#34;</span><span style=color:#f92672>]}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T04:08:00.910Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;successfully connected to kafka cluster&#34;</span>,<span style=color:#e6db74>&#34;advertised_broker_count&#34;</span>:1,<span style=color:#e6db74>&#34;topic_count&#34;</span>:0,<span style=color:#e6db74>&#34;controller_id&#34;</span>:1234570725,<span style=color:#e6db74>&#34;kafka_version&#34;</span>:<span style=color:#e6db74>&#34;between v0.10.2 and v0.11.0&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#e6db74>&#34;ts&#34;</span>:<span style=color:#e6db74>&#34;2025-08-06T04:08:01.111Z&#34;</span>,<span style=color:#e6db74>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;Server listening on address&#34;</span>,<span style=color:#e6db74>&#34;address&#34;</span>:<span style=color:#e6db74>&#34;[::]:8080&#34;</span>,<span style=color:#e6db74>&#34;port&#34;</span>:8080<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>I was then able to view the Redpanda console in my browser at http://localhost:8080/overview.</p><h3 class="relative group">Working with Protobuf and the BSR<div id=working-with-protobuf-and-the-bsr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#working-with-protobuf-and-the-bsr aria-label=Anchor>#</a></span></h3><p>Continuing with the quickstart, I cloned the Github repo and moved the previously installed <code>bufstream</code> CLI to the cloned directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/bufbuild/bufstream-demo.git <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    mv bufstream ./bufstream-demo <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    cd ./bufstream-demo
</span></span></code></pre></div><p>This repo contains pre-created Protobuf files that have integration and support for Confluent-compatabile schema registries (which BSR complies with).</p><p>An example proto file is in <code>proto/bufstream/demo/v1/demo.proto</code> of the cloned repo and defines an <code>EmailUpdated</code> message.</p><p>Things get a little unclear here but from what I understand, this <code>demo.proto</code> file imports a reference to a confluent module with <code>import "buf/confluent/v1/extensions.proto";</code> and this is what enables the BSR to be compatible with Confluent schema registry. The mapping between the proto file and the topic is done with <code>name: "email-updated-value"</code>. So the topic name here becomes <code>email-updated</code>.</p><h3 class="relative group">Producing and Consuming data<div id=producing-and-consuming-data class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#producing-and-consuming-data aria-label=Anchor>#</a></span></h3><p>The quickstart references a <code>go run ./cmd/bufstream-demo-produce ...</code> and <code>go run ./cmd/bufstream-demo-consume ...</code> but I&rsquo;ve noticed that the cloned repo comes with a <code>Makefile</code>. That would be simpler to use here but the produce/consume commands seem to be out of sync so we&rsquo;ll stick with what the demo suggests to be safe.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go run ./cmd/bufstream-demo-produce <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --topic email-updated <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --group email-verifier <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --csr-url <span style=color:#e6db74>&#34;https://demo.buf.dev/integrations/confluent/bufstream-demo&#34;</span>
</span></span><span style=display:flex><span>go run ./cmd/bufstream-demo-produce --topic email-updated --group email-verifier
</span></span><span style=display:flex><span>go: downloading github.com/brianvoe/gofakeit/v7 v7.3.0
</span></span><span style=display:flex><span>go: downloading github.com/google/uuid v1.6.0
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>&lt;downloading lots of go libs here&gt;
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:41:20.299-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;produced semantically invalid protobuf message&#34;</span> id<span style=color:#f92672>=</span>072da6ca-8878-4c11-944b-5876a4fc4370
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:41:20.450-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;produced invalid data&#34;</span> id<span style=color:#f92672>=</span>32bc2119-f1bb-43f4-a9db-28fbb04ff7b5
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:41:21.588-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;produced semantically valid protobuf message&#34;</span> id<span style=color:#f92672>=</span>d6fc0bf3-e13b-421f-a696-212059d7961d
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>So a lot of data is being generated, some of which is considered semantically invalid. Looking in the RedPanda console, I can see sample data such as <code>foobar</code> as well as other sample data such as <code>$f4525add-da7d-4b2b-aae9-884e7bab535dgarnettwunsch@dickens.netllama</code>, it&rsquo;s clear which of these 2 do not conform to the proto schema.</p><p>Now I&rsquo;ll try the <code>make</code> target <code>make consume-run</code> and see what happens since this is consistent with the snippet in the blog (unlike the produce).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make consume-run
</span></span><span style=display:flex><span>go run ./cmd/bufstream-demo-consume --topic email-updated --group email-verifier <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--csr-url <span style=color:#e6db74>&#34;https://demo.buf.dev/integrations/confluent/bufstream-demo&#34;</span>
</span></span><span style=display:flex><span>make consume-run
</span></span><span style=display:flex><span>go run ./cmd/bufstream-demo-consume --topic email-updated --group email-verifier <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--csr-url <span style=color:#e6db74>&#34;https://demo.buf.dev/integrations/confluent/bufstream-demo&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:48:44.981-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;starting consume&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:48:44.982-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;consumed message with new email sisterglover@labadie.biz and old email orvilledickinson@turcotte.biz&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:48:45.984-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;consumed message with new email hound and old email antoniomurphy@bradtke.info&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-06T22:48:45.984-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;consumed malformed data&#34;</span> error<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;registration is missing for encode/decode&#34;</span> length<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>The log message <code>consumed malformed data</code> makes it sound like the consumer is consuming the data even if it is malformed and does not conform to the schema. This seems unexpected but I may have a misunderstanding on how this works.</p><p>The quickstart then suggests to run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./bufstream serve --config config/bufstream.yaml
</span></span></code></pre></div><p>&mldr;which now seems to tie it all together by ensuring that the consumer has a connection to the BSR and ensuring that the Consumer only sees records that comply with the registered schema. I verified that schema enforcement does seem to be happening here by reviewing the terminal output for the producer and consumer. The Producer shows invalid records (e.g. does not conform to the schema):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># sample invalid log message from the producer</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-09T22:36:50.224-05:00 level<span style=color:#f92672>=</span>ERROR msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;error on produce of invalid data&#34;</span> error<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;failed to produce: INVALID_RECORD: This record has failed the validation on the broker and hence been rejected.&#34;</span>
</span></span></code></pre></div><p>&mldr;but the Consumer logs, <em>only</em> showed valid messages such as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># sample valid log message from the consumer</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2025-08-09T22:36:45.222-05:00 level<span style=color:#f92672>=</span>INFO msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;consumed message with new email monkey and old email ernestlegros@parisian.name&#34;</span>
</span></span></code></pre></div><h2 class="relative group">Bufstream and Apache Spark<div id=bufstream-and-apache-spark class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#bufstream-and-apache-spark aria-label=Anchor>#</a></span></h2><p>If Bufstream really is a drop-in replacement for Apache Kafka, reading from Bufstream with Spark should also be straight-forward. Let&rsquo;s confirm this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.sql <span style=color:#f92672>import</span> DataFrame
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.sql <span style=color:#f92672>import</span> functions <span style=color:#66d9ef>as</span> sf
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.sql.streaming.readwriter <span style=color:#f92672>import</span> DataStreamWriter
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.sql.streaming.query <span style=color:#f92672>import</span> StreamingQuery
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KAFKA_BOOTSTRAP_SERVERS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;localhost:9092&#34;</span>
</span></span><span style=display:flex><span>TOPIC <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;email-updated&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df: DataFrame <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    spark
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>readStream
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;kafka&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;kafka.bootstrap.servers&#34;</span>, KAFKA_BOOTSTRAP_SERVERS)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;subscribe&#34;</span>, TOPIC)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;startingOffsets&#34;</span>, <span style=color:#e6db74>&#34;earliest&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>load()
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>selectExpr(<span style=color:#e6db74>&#34;CAST(key AS STRING)&#34;</span>, <span style=color:#e6db74>&#34;CAST(value AS STRING)&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>datastream_writer: DataStreamWriter <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    df
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>select(<span style=color:#e6db74>&#34;value&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>writeStream
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;console&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;truncate&#34;</span>, <span style=color:#e6db74>&#34;false&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>streaming_query: StreamingQuery <span style=color:#f92672>=</span> datastream_writer<span style=color:#f92672>.</span>start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------</span>
</span></span><span style=display:flex><span>Batch: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+---------------------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>value                                                                                        <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+---------------------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>926</span>b3e7f<span style=color:#f92672>-</span><span style=color:#ae81ff>0311</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b0e<span style=color:#f92672>-</span><span style=color:#ae81ff>8925</span><span style=color:#f92672>-</span>e49b653e3f95jacqueskoss<span style=color:#a6e22e>@lehner.info</span><span style=color:#960050;background-color:#1e0010>�</span>alexisgraham<span style=color:#a6e22e>@raynor.com</span>    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span>c0ec4ae6<span style=color:#f92672>-</span>d7c0<span style=color:#f92672>-</span><span style=color:#ae81ff>49</span>d0<span style=color:#f92672>-</span><span style=color:#ae81ff>96</span>f3<span style=color:#f92672>-</span>f45e5df45e78jewelrohan<span style=color:#a6e22e>@strosin.org</span><span style=color:#960050;background-color:#1e0010>�</span>salmon                      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>foobar                                                                                      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span>a1d8b79c<span style=color:#f92672>-</span><span style=color:#ae81ff>87</span>c5<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>dde<span style=color:#f92672>-</span><span style=color:#ae81ff>9183</span><span style=color:#f92672>-</span>b702e5b5b334marshallreynolds<span style=color:#a6e22e>@armstrong.io</span><span style=color:#960050;background-color:#1e0010>�</span>ericklittle<span style=color:#a6e22e>@lang.name</span><span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span>ab20b911<span style=color:#f92672>-</span><span style=color:#ae81ff>7</span>bee<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>fe9<span style=color:#f92672>-</span><span style=color:#ae81ff>8366</span><span style=color:#f92672>-</span><span style=color:#ae81ff>6211766412</span>dfgissellejohnston<span style=color:#a6e22e>@runolfsson.org</span><span style=color:#960050;background-color:#1e0010>�</span>\vgrasshopper       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>foobar                                                                                      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span>f89d1a48<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>d9b<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>d77<span style=color:#f92672>-</span>a872<span style=color:#f92672>-</span>d39be4c61921rickybechtelar<span style=color:#a6e22e>@stamm.net</span><span style=color:#960050;background-color:#1e0010>�</span>raoulbeahan<span style=color:#a6e22e>@rutherford.io</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>8</span>af0f411<span style=color:#f92672>-</span>c2ed<span style=color:#f92672>-</span><span style=color:#ae81ff>494</span>d<span style=color:#f92672>-</span>ac82<span style=color:#f92672>-</span>e495b111045austinanitzsche<span style=color:#a6e22e>@lebsack.net</span><span style=color:#960050;background-color:#1e0010>�</span>\bplatypus              <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>foobar                                                                                      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span>a58f1996<span style=color:#f92672>-</span>c6b2<span style=color:#f92672>-</span><span style=color:#ae81ff>416</span>b<span style=color:#f92672>-</span><span style=color:#ae81ff>8531</span><span style=color:#f92672>-</span>a603921dd828marisafunk<span style=color:#a6e22e>@towne.net</span><span style=color:#960050;background-color:#1e0010>�</span>blakerippin<span style=color:#a6e22e>@kemmer.biz</span>        <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>\n<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>48</span>fa5f74<span style=color:#f92672>-</span><span style=color:#ae81ff>5921</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4061</span><span style=color:#f92672>-</span>ad25<span style=color:#f92672>-</span><span style=color:#ae81ff>559</span>ce2cb6e7aeleonoreupton<span style=color:#a6e22e>@rohan.net</span><span style=color:#960050;background-color:#1e0010>�</span>wasp                       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>foobar
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>So this appeared to work at a very basic level, but this is not how we should be performing reads via Spark given that we want our consumers to know and cross-reference the expected schema defined in the BSR. Given that we confirmed this worked as expected with the above Consumer, we will for now presume that this capability is possible with Spark as well and leave the full Spark &ndash;> BSR integration for later research.</p><h2 class="relative group">What about Iceberg?<div id=what-about-iceberg class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-about-iceberg aria-label=Anchor>#</a></span></h2><p>I followed the <a href=https://buf.build/docs/bufstream/iceberg/quickstart target=_blank>Iceberg quickstart</a> but it seems like the compose file is referencing a <code>spark/</code> directory that doesn&rsquo;t exist: <code>OSError: Dockerfile not found in /home/username/tmp/buf-examples/bufstream/iceberg-quickstart/spark</code> .So I couldn&rsquo;t get this working but according to the guide, all you need is:</p><ul><li>Bufstream broker</li><li>object storage</li><li>an Iceberg catalog implementation</li></ul><p>The details of your Iceberg catalog are defined in <code>config/bufstream.yaml</code>.</p><h2 class="relative group">What about Bufstream in Production?<div id=what-about-bufstream-in-production class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-about-bufstream-in-production aria-label=Anchor>#</a></span></h2><p>The initial impression I had of Bustream is that deployments are super simple. I suppose this is true, in comparison to a Kafka deployment, but it still requires:</p><ul><li>Object storage such as AWS S3, Google Cloud Storage, or Azure Blob Storage.</li><li>A metadata storage service such as PostgreSQL.</li></ul><p>There are numerous different deployment options such as Docker, Helm, and others with a provided Terraform module. It&rsquo;s unclear if BSR requires an additional set of deployments or if that is integrated into Postgres.</p><h2 class="relative group">Recap<div id=recap class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#recap aria-label=Anchor>#</a></span></h2><ul><li>Buf&rsquo;s vision seems well-thought and clearly-defined.<ul><li>A simplified Kafka-compatible streaming engine</li><li>A single way to manage schemas with Protobuf</li><li>Schema enforcement with the BSR</li><li>Data Lakehouse integration with Apache Iceberg</li></ul></li><li>The streaming market has no shortage of vended options but Buf&rsquo;s vision really makes it stand out.</li><li>Protobuf has the reputation for being less user-friendly than other serialization formats like JSON but this may change if the <code>buf</code> CLI can keep it&rsquo;s promises of simplifying the schema mangement experience.</li></ul></div></div><script type=text/javascript src=/blog/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/kafka-protobuf-and-bufstream/index.md data-oid-likes=likes_posts/kafka-protobuf-and-bufstream/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/blog/posts/pyspark-container-unit-tests/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Using a Container to run PySpark Unit Tests
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-07-12T12:58:15-05:00>2025-07-12</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/blog/posts/evaluating-vlang/><span class=leading-6>Evaluating V (Language)&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-08-25T19:39:16-05:00>2025-08-25</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/blog/tags/ title=Tags>Tags</a></li><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/blog/posts/ title=Posts>Posts</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Brock B</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/blog/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://be-rock.github.io/blog/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>